<!DOCTYPE html>
<!--[if lt IE 8 ]><html class="ie ie7" lang="en"> <![endif]-->
<!--[if IE 8 ]><html class="ie ie8" lang="en"> <![endif]-->
<!--[if (gte IE 8)|!(IE)]><!--><html lang="en"> <!--<![endif]-->
<head>


   <!--- Basic Page Needs
   ================================================== -->
   <meta charset="utf-8">
   <title>SmartEnergy Saving</title>
   <meta name="description" content="">
   <meta name="author" content="">

   <!-- Mobile Specific Metas
   ================================================== -->
   <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

	<!-- CSS
   ================================================== -->
   <link rel="stylesheet" href="css/base.css">
   <link rel="stylesheet" href="css/layout.css">
	<link rel="stylesheet" type="text/css" href="css/normalize.css" />
		<link rel="stylesheet" type="text/css" href="css/demo.css" />
		<link rel="stylesheet" type="text/css" href="css/component.css" />

	<!--[if lt IE 9]>
		<script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

   <!-- Favicons
   ================================================== -->
   <link rel="shortcut icon" href="favicon.ico" >


</head>

<body data-spy="scroll" data-target="#nav-wrap">


   <!-- Header
   ================================================== -->
   <header class="mobile">

      <div class="row">

         <div class="col full">

            <div class="logo">
               <a href="#">SEILContest</a>
            </div>

            <nav id="nav-wrap">

               <a class="mobile-btn" href="#nav-wrap" title="Show navigation">Show navigation</a>
               <a class="mobile-btn" href="#" title="Hide navigation">Hide navigation</a>

               <ul id="nav" class="nav">
                <li><a href="#intro">Home</a></li>
                <li><a href="#services">Contest</a></li>
                <li><a href="#portfolio">DashBoard</a></li>
                <li><a href="#about">About Us</a></li>
                <li><a href="#contact">Contact</a></li>
             </ul>

          </nav>

       </div>

    </div>

 </header> <!-- Header End -->


   <!-- Intro Sectionprovides an integration platform to design Smart Grid, which refers to utility electric grid with ability of computerised remote control and automation which provides an infrastructure to fulfil the growing demands of electric energy
   ================================================== -->
   <section id="intro">

      <!-- Flexslider Start-->
      <div id="intro-slider" class="flexslider">

        <ul class="slides">

         <!-- Slide -->
         <li>
          <div class="row">
           <div class="col full">
            <div class="slider-text">
             <h2>Hello, we are <span>Smart Energy Informatics lab</span>. We provide an integrated platform to design Smart Grid.</h2>
             <p>which refers to utility electric grid with ability of computerised remote control and automation which provides an infrastructure to fulfil the growing demands of electric energy.</p>
          </div>
       </div>
    </div>
 </li>

 <!-- Slide -->
 <li>
    <div class="row">
     <div class="col full">
      <div class="slider-text">
       <h2>We are comparing energy footprint of different <span> labs and kresit building </span>of IITBombay. </h2>
       <p>Smart Energy Informatics lab is a platform to find ways to improve service and meet customers energy needs in a smart, lower-carbon way. Renewable generation and energy efficiency must, and will, play a larger role.</p>
    </div>
 </div>
</div>
</li>

</ul>
</div>
<!-- Flexslider End-->

</section> <!-- Intro Section End-->


   <!-- Services Section
   ================================================== -->
   <section id="services">

      <div class="row section-head">

         <div class="col one-third">
            <h2>Contest</h2>
         </div>

      </div>

      <div class="row">
         <div class="services.wrapper">

            <div class="colleft">
              <div id="dropDownDiv" >
                 <select id="dropDown"  style="min-width:158px;">
                  <option value="1">Week1-6/1</option>
                  <option value="2">Week2-13/1</option>
                  <option value="3">Week3-20/1</option>
                  <option value="4" selected="selected">Week4-27/1</option>
               </select>		
            </div>
	<br>
            <nav id="nav-wrap" style="background: url('images/k-opacity-70.png') repeat scroll 0% 0% transparent;">
               <ul id="vnav" class="vnav">
                  <li class="active"><a id='stats' style="font-size: 17px;" href="#services" onclick="return update_contest_section(this);">Stats</a></li>
                  <li><a id='score' style="font-size: 17px;" href="#services" onclick="return update_contest_section(this);">Performance</a></li>
                  
                  <li><a id='comparision' style="font-size: 17px;" href="#services" onclick="return update_contest_section(this);">Comparision</a></li>
                  <li><a id='defaulters' style="font-size: 17px;" href="#services" onclick="return update_contest_section(this);">Defaulters</a></li>
	<li></li>
	<li><a id='winner' style="font-size: 17px;" href="#services" onclick="return update_contest_section(this);">Contest Winners</a></li>
               </ul> 
            </nav>
         </div>

         <div class="colrem">
            <div id="container" style="min-width: 55.0%"></div>
         </div>

      </div>
   </div>

</section>
   <!-- Portfolio Section
   ================================================== -->
   <section id="portfolio">

      <div class="row section-head">
         <div class="col full">

            <h2>DashBoard</h2>
            <p class="desc">Check out Interesting analysis.</p>
	  <div class="row">
	<div id="datecontainer" class="colrem" style="margin-left:20%">
	<p> Date: <input type="text" id="datepicker" ></p>
	</div>
	</div>
	 <div id="master" class="row" style="display:none;">
	
<div id="detailcontainer1" class="colleft" style="margin-left:20%">
	<p> Time-span:  <div id="dropDownDiv" >
        
	<select id="duration"> 
		<option value="1">1 Month</option> <option value="2" selected="selected">2 Month</option>
 	</select> 
 </div> </p>
	</div>
	<div id="detailcontainer2" class="colrem" >
	<p> Parameter:  <div id="dropDownDiv2" >

	<select id="parameter"> 
		<option value="1">Current</option> <option value="2" >Voltage</option> <option value="3"selected="selected">Power</option>
	 </select>
	    </div> </p>
	</div>






	</div>
      <div class="row">
	
         <div class="colleft">
             
            <nav id="nav-wrap" style="background: url('images/k-opacity-70.png') repeat scroll 0% 0% transparent;">
              
               <ul id="vnav" class="vnav">
                  <li class="active"><a id='appdata' style="font-size: 17px;" href="#portfolio" onclick="return update_dashboard_section(this);">Appliance Data</a></li>
                  <li><a id='kresit' style="font-size: 17px;" href="#portfolio" onclick="return update_dashboard_section(this);">Kresit Data</a></li>
                  <li><a id='realtime' style="font-size: 17px;" href="#portfolio" onclick="return update_dashboard_section(this);">Realtime Plot</a></li>
		<li><a id='masterdetail' style="font-size: 17px;" href="#portfolio" onclick="return update_dashboard_section(this);">MasterDetail</a></li>
                  
               </ul> 
            
            </nav>
      
         </div>

	        <div  id = "chartsdiv"class="colrem">
		
               <div id="container1" style="min-width: 55.0%"></div>

            </div>

       </div>

</section> <!-- Portfolio End -->


   <!-- About Section
   ================================================== -->
   <section id="about">

      <div class="row section-head">

         <div class="col one-fourth">
            <h2>About Us</h2>
            <p class="desc">This is what we are.</p>
         </div>

         <!-- <div class="col three-fourths">
             <p class="intro">Proin gravida nibh vel velit auctor aliquet. Aenean sollicitudin, lorem quis bibendum auctor,
             nisi elit consequat ipsum, nec sagittis sem nibh id elit. Duis sed odio sit amet nibh vulputate
             cursus a sit amet mauris. Morbi accumsan ipsum velit. Nam nec tellus a odio tincidunt auctor a
             ornare odio. Sed non  mauris vitae erat consequat auctor eu in elit. </p>
          </div> -->

       </div>

       <div class="row">
         <div class="col full"><h3>Our Work Process.</h3></div>
      </div>

      <!-- <div class="row process-wrap">

         <div class="col">
            <h4>Explore.</h4>

            <p>Proin gravida nibh vel velit auctor aliquet. Aenean sollicitudin, lorem quis bibendum auctor,
            nisi elit consequat ipsum, nec sagittis sem nibh id elit. Duis sed odio sit amet nibh vulputate
            cursus a sit amet mauris. Morbi accumsan ipsum velit.</p>
			</div>

         <div class="col">
            <h4>Design.</h4>

            <p>Proin gravida nibh vel velit auctor aliquet. Aenean sollicitudin, lorem quis bibendum auctor,
            nisi elit consequat ipsum, nec sagittis sem nibh id elit. Duis sed odio sit amet nibh vulputate
            cursus a sit amet mauris. Morbi accumsan ipsum velit. Duis sed odio sit.
            </p>
			</div>

         <div class="col m-first">
            <h4>Develop.</h4>

            <p>Proin gravida nibh vel velit auctor aliquet. Aenean sollicitudin, lorem quis bibendum auctor,
            nisi elit consequat ipsum, nec sagittis sem nibh id elit. Duis sed odio sit amet nibh vulputate
            cursus a sit amet mauris. Morbi accumsan ipsum velit.</p>
			</div>

         <div class="col">
            <h4>Deliver.</h4>

            <p>Proin gravida nibh vel velit auctor aliquet. Aenean sollicitudin, lorem quis bibendum auctor,
            nisi elit consequat ipsum, nec sagittis sem nibh id elit. Duis sed odio sit amet nibh vulputate
            cursus a sit amet mauris. Morbi accumsan ipsum velit. Duis sed odio sit.
            </p>
         </div> -->

      </div> <!-- Process Wrap End -->

      <div class="row">
         <div class="col full"><h3>Meet The Team.</h3></div>
      </div>


      <!-- Team Wrap End -->
      <div class="row team-wrap">

         <div class="col one-fourth">

            <img src="images/team/team-img-01.jpg" alt=""/>

            <div class"member-name">
               <h5>Mayur kale</h5>
               <span>Director</span>
            </div>

            <ul class="member-social">
               <li><a href="#"><i class="icon-facebook"></i></a></li>
               <li><a href="#"><i class="icon-twitter"></i></a></li>
               <li><a href="#"><i class="icon-google-plus-sign"></i></a></li>
               <li><a href="#"><i class="icon-linkedin"></i></a></li>
               <li><a href="#"><i class="icon-skype"></i></a></li>
            </ul>

         </div>

         <div class="col one-fourth">

            <img src="images/team/team-img-01.jpg" alt=""/>

            <div class"member-name">
               <h5>Nikhilkumar Jadhav</h5>
               <span>Director</span>
            </div>

            <ul class="member-social">
               <li><a href="#"><i class="icon-facebook"></i></a></li>
               <li><a href="#"><i class="icon-twitter"></i></a></li>
               <li><a href="#"><i class="icon-google-plus-sign"></i></a></li>
               <li><a href="#"><i class="icon-linkedin"></i></a></li>
               <li><a href="#"><i class="icon-skype"></i></a></li>
            </ul>

         </div>

         <div class="col one-fourth">

            <img src="images/team/team-img-01.jpg" alt=""/>

            <div class"member-name">
               <h5>Nilang Shah</h5>
               <span>Senior Web Designer</span>
            </div>

            <ul class="member-social">
               <li><a href="#"><i class="icon-facebook"></i></a></li>
               <li><a href="#"><i class="icon-twitter"></i></a></li>
               <li><a href="#"><i class="icon-google-plus-sign"></i></a></li>
               <li><a href="#"><i class="icon-linkedin"></i></a></li>
               <li><a href="#"><i class="icon-skype"></i></a></li>
            </ul>

         </div>

         <div class="col one-fourth">

            <img src="images/team/team-img-01.jpg" alt=""/>

            <div class"member-name">
               <h5>Karan P</h5>
               <span>Web Designer</span>
            </div>

            <ul class="member-social">
               <li><a href="#"><i class="icon-facebook"></i></a></li>
               <li><a href="#"><i class="icon-twitter"></i></a></li>
               <li><a href="#"><i class="icon-google-plus-sign"></i></a></li>
               <li><a href="#"><i class="icon-linkedin"></i></a></li>
               <li><a href="#"><i class="icon-skype"></i></a></li>
            </ul>

         </div>

      </div> <!-- Team Wrap End -->

      <!-- Testimonials -->
	
      <div class="row">

         <div class="col full section-head">
            <h2>Testimonials</h2>
            <p class="desc">What our clients are saying.</p>
         </div>

      </div>

      <div class="row testimonials">

         <div class="col half">

            <div class="client-author">
               <img src="images/client-img.png" alt="" />
               <div class="name">
                  <p>Nabeel Nasir<span>Developer</span></p>
               </div>
            </div>

            <div class="client-cite">
               <p>This is perhaps the best site I have</p>
            </div>

         </div>

         <div class="col half">

            <div class="client-author">
               <img src="images/client-img.png" alt="" />
               <div class="name">
                  <p>Amandeep Chugh<span>Entrepreneur</span></p>
               </div>
            </div>

		     <!--  <div class="client-cite">
			      <p>Nascetur augue hac platea enim, egestas pulvinar vut. Pulvinar cum, ac eu, tristie
               acus duis in dictumst non integer. Elit, sed scelerisque odio tortor, sed platea dis.
               Aenean condimentum, lacus sit amet luctus lobortis,
               enim tellus ultrices elit.</p>
            </div> -->

         </div>

      </div> <!--  Testimonials End-->


   </section> <!-- About Section End-->

   <!-- Call-to-Action Section
   ================================================== -->
   <!--section id="call-to-action">

      <div class="row">

         <div class="col three-fourths">

            <h2><a rel="nofollow" href="http://www.a2hosting.com/?utm___source=styleshoutdemo&utm_medium=__cpm&utm_content=&utm_campaign=">Host This Template on A2 Hosting.</a></h2>
            <p>300% Faster Hosting on Their SwiftServer SSDs.</p>

         </div>

         <div class="col one-fourth action">

            <a rel="nofollow" href="http://www.a2hosting.com/?utm___source=styleshoutdemo&utm_medium=__cpm&utm_content=&utm_campaign=" class="button">Sign Up Now</a>

         </div>

      </div>


   </section--> <!-- Call-to-Action Section End-->

   <!-- Map Section
   ================================================== -->
   <section id="map">

      <p class="map-error">Something went wrong... Unable to load map... Please try to enable javascript</p>

   </section> <!-- Map Section End-->

    <!-- Contact Section
    ================================================== -->
    <section id="contact">

      <div class="row section-head">
         <div class="col full">
            <h2>Contact Us</h2>
            <p class="desc">Get in touch with us.</p>
         </div>
      </div>

      <div class="row">

         <div class="col g-7">

            <!-- form -->
            <form name="contactForm" id="contactForm" method="post" action="">
              <fieldset>

               <div>
                  <label for="contactName">Name <span class="required">*</span></label>
                  <input name="contactName" type="text" id="contactName" size="35" value="" />
               </div>

               <div>
                  <label for="contactEmail">Email <span class="required">*</span></label>
                  <input name="contactEmail" type="text" id="contactEmail" size="35" value="" />
               </div>

               <div>
                  <label for="contactSubject">Subject</label>
                  <input name="contactSubject" type="text" id="contactSubject" size="35" value="" />
               </div>

               <div>
                  <label  for="contactMessage">Message <span class="required">*</span></label>
                  <textarea name="contactMessage"  id="contactMessage" rows="15" cols="50" ></textarea>
               </div>

               <div>
                  <button class="submit">Submit</button>
                  <span id="image-loader">
                     <img src="images/loader.gif" alt="" />
                  </span>
               </div>

            </fieldset>
         </form> <!-- Form End -->

         <!-- contact-warning -->
         <div id="message-warning"></div>
         <!-- contact-success -->
         <div id="message-success">
            <i class="icon-ok"></i><br />
            Your message was sent, thank you!<br/>
         </div>

      </div>


      <aside class="col g-5">

         <h3>Contact Information</h3>

         <p>Smart Energy Informatic Lab</p>

         <p>
            213,KReSIT Building <br />
            IIT Bombay,Powai <br />
            Mumbai-400076,India
         </p>

         <p>
            Phone: 022-25722545-4937  <br />
         </p><br />



      </aside>

   </div>

</section> <!-- Contact Section End-->

   <!-- footer
   ================================================== -->
   <footer>

      <div class="row">

         <div class="col g-7">
            <ul class="copyright">
               <!--<li>&copy; 2013 Kreative</li> -->
               <li>Design by <a href="http://www.styleshout.com/" title="Styleshout">Styleshout</a></li>
               <li>Sponsored by <a rel="nofollow" href="http://www.a2hosting.com/?utm___source=styleshoutdemo&utm_medium=__cpm&utm_content=&utm_campaign=">A2Hosting</a></li>
            </ul>
         </div>

         <div class="col g-5 pull-right">
            <ul class="social-links">
               <li><a href="#"><i class="icon-facebook"></i></a></li>
               <li><a href="#"><i class="icon-twitter"></i></a></li>
               <li><a href="#"><i class="icon-google-plus-sign"></i></a></li>
               <li><a href="#"><i class="icon-linkedin"></i></a></li>
               <li><a href="#"><i class="icon-skype"></i></a></li>
               <li><a href="#"><i class="icon-rss-sign"></i></a></li>
            </ul>
         </div>

      </div>

   </footer> <!-- Footer End-->

   <!-- Java Script
   ================================================== -->
   <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
<script src="//code.jquery.com/ui/1.10.4/jquery-ui.js"></script>

   <script>window.jQuery || document.write('<script src="js/jquery-1.10.2.min.js"><\/script>')</script>
   <script type="text/javascript" src="js/jquery-migrate-1.2.1.min.js"></script>


<link rel="stylesheet" href="//code.jquery.com/ui/1.10.4/themes/smoothness/jquery-ui.css">
   <script src="js/scrollspy.js"></script>
   <script src="js/jquery.ddslick.min.js"></script>
   <script src="js/jquery.flexslider.js"></script>
   <script src="js/jquery.reveal.js"></script>
   <script src="http://maps.google.com/maps/api/js?sensor=true" type="text/javascript"></script>
   <script src="js/gmaps.js"></script>
   <script src="js/init.js"></script>
	<script src="js/jquery.stickyheader.js"></script>
   <script src="js/smoothscrolling.js"></script>

   <!-- Contest page related -->

   <script src="highcharts/js/highcharts.js"></script>
   <script src="highcharts/js/modules/drilldown.js"></script>
   <script src="highcharts/js/modules/exporting.js"></script>
   <script type="text/javascript">
var interval;
    var chart;
function formattedDate(date) {
	 var d = new Date();
    	d.setDate(d.getDate()-1);
        month = '' + (d.getMonth() + 1),
        day = '' + d.getDate(),
        year = d.getFullYear();

    if (month.length < 2) month = '0' + month;
    if (day.length < 2) day = '0' + day;

    return [month,day, year].join('/');
}

$( "#datepicker" ).val(formattedDate());
$( "#datepicker" ).datepicker({ maxDate: "-1d ",onSelect: function(selected,evnt) {
         updateAb(selected);
    } });

function updateAb(value){     
       //chart.redraw();
	console.log($('#vnav .active a')[1]);
	update_dashboard_section($('#vnav .active a')[1]);
};


var data = [];


var resp;

function update_dashboard_section(target){
	
    $(target).parent().parent().children().removeClass('active')
    $(target).parent().addClass('active')
    if($(target).attr('id')=='realtime'){
	$('#datecontainer').show();
	$('#master').hide();
	
	$.ajax({
		type:"GET",
		url:"pymongo/getRealData.php",
		async:false,
		success:function(response){
			resp = $.parseJSON(response);
		}
	})
  	
	
      var maxPowerConsumption = 100;
      var minPowerConsumption = 77.38;
   
        $('#container1').highcharts({
            chart: {
                //type: 'spline',
                animation: Highcharts.svg, // don't animate in old IE
                marginRight: 10,
                events: {
                    load: function() {
    
                        // set up the updating of the chart each second
                        var series = this.series[0];
			var series2= this.series[1];
                        var series3= this.series[2];
			var series4= this.series[3];
                       interval = setInterval(function() {
				//clearInterval(interval);
				//return;
                            var x = (new Date()).getTime() // current time
			    $.ajax({
				    type:"GET",
				    url:"pymongo/getRealTimeData.php",
				    async:false,
				    success:function(response){
					resp = $.parseJSON(response);
					y = resp.power;
		                        series.addPoint([x, y], true, true);
		                        y = resp.current;
		                        series2.addPoint([x, y], true, true);
		                        y = resp.voltage;
		                        series3.addPoint([x, y], true, true);
		                        y = resp.frequency;
		                        series4.addPoint([x, y], true, true);
				    }
			    })
                        }, 2000);
                    }
                }
            },
            title: {
                text: 'Realtime Energy Consumption'
            },
            xAxis: {
		type:"datetime",
                tickPixelInterval: 150
            },
            yAxis: {
		min:0,
                title: {
                    text: 'Power consumption(kW)'
                },
                plotLines: [{
                    value: 0,
                    width: 1,
                    color: '#808080'
                }]
            },
            tooltip: {
                formatter: function() {
                        return '<b>'+ this.series.name +'</b><br/>'+
                        Highcharts.dateFormat('%Y-%m-%d %H:%M:%S', this.x) +'<br/>'+
                        Highcharts.numberFormat(this.y, 2);
                }
            },
            legend: {
                enabled: true
            },
            exporting: {
                enabled: false
            },
	 plotOptions: {
            series: {
                marker: {
                    enabled: false
                }
            }
        },
            series: [{
                name: 'kW',
		  lineWidth: 1,
                data: (function() {
		    // generate an array of random data
                    var data = [];
                    for (i = 0; i < 300; i++) {
                        data.push({
                            x: new Date(resp[i].time).getTime(),
                            y: resp[i].power
                        }); 
                    }
		    return data;
                })()
            },{
                name: 'A',
		  lineWidth: 1,
                data: (function() {
                    // generate an array of random data
                    var data = [];
                    for (i = 0; i < 300; i++) {
                        data.push({
                            x: new Date(resp[i].time).getTime(),
                            y: resp[i].current
                        }); 
                    }
			return data;
                })()
            },{
                name: 'V',
		  lineWidth: 1,
                data: (function() {
                    // generate an array of random data
                    var data = [];
                    for (i = 0; i < 300; i++) {
                        data.push({
                            x: new Date(resp[i].time).getTime(),
                            y: resp[i].voltage
                        }); 
                    }
			return data;
                })()
            },{
                name: 'F',
		  lineWidth: 1,
                data: (function() {
                    // generate an array of random data
                    var data = [];
                    for (i = 0; i < 300; i++) {
                        data.push({
                            x: new Date(resp[i].time).getTime(),
                            y: resp[i].frequency
                        }); 
                    }
                    return data;
                })()
            }]
        });
/*
,{
                name: 'A1',
		  lineWidth: 1,
                data: (function() {
                    // generate an array of random data
                    var data = [];
                    for (i = 0; i < 300; i++) {
                        data.push({
                            x: new Date(resp[i].time).getTime(),
                            y: resp[i].A1
                        }); 
                    }
                    return data;
                })()
            },{
                name: 'A2',
		  lineWidth: 1,
                data: (function() {
                    // generate an array of random data
                    var data = [];
                    for (i = 0; i < 300; i++) {
                        data.push({
                            x: new Date(resp[i].time).getTime(),
                            y: resp[i].A2
                        }); 
                    }
                    return data;
                })()
            },{
                name: 'A3',
		  lineWidth: 1,
                data: (function() {
                    // generate an array of random data
                    var data = [];
                    for (i = 0; i < 300; i++) {
                        data.push({
                            x: new Date(resp[i].time).getTime(),
                            y: resp[i].A3
                        }); 
                    }
                    return data;
                })()
            }
*/
    }else if($(target).attr('id')=='appdata'){
	$('#datecontainer').show();
	$('#master').hide();
	clearInterval(interval);     
	 var dataFile = "pymongo/makeGraphJson.php?date="+$('#datepicker').val(); 
      $.getJSON(dataFile, function(jsonData) {
	 var days = [];
         var map = {};
         var averages = [];
         var tmap = {};
         var values = [];
         var pieValues = [];
         $.each(jsonData.days,function(entryIndex, entry) {
            days[entryIndex]= this;
         });
        
         $.each(jsonData.components,function(entryIndex, entry) {
            map[this.name]=this.values;
            tmap[this.name]=this.total;
         });
        
         index = 0;
         $.each( map, function( key, value ) {
            values[index] = {type:'column',name:key,data:value};
            index = index + 1;
         });
         averages=jsonData.averages;
         values[index] = 
         {
                type: 'spline',
                name: 'Average',
                data: averages,
                marker: {
                  lineWidth: 2,
                  lineColor: Highcharts.getOptions().colors[3],
                  fillColor: 'white'
               }
         }
         index = index + 1
         // new Index
         var newIndex = 0
         $.each( tmap, function( key, value ) {
            pieValues[newIndex] = {name:key,y:value,color:Highcharts.getOptions().colors[newIndex]};
            newIndex = newIndex + 1;
         });
         console.log(pieValues);
         values[index] = {
                type: 'pie',
                name: 'Total consumption',
                data: pieValues,
                center: [20, 0],
                size: 100,
                showInLegend: false,
                dataLabels: {
                    enabled: false
                }
            }
         $('#container1').highcharts({
            chart: {
            },
            title: {
                text: 'Appliances chart'
            },
            xAxis: {
                categories: days
            },
	            yAxis: {
			 title: {
                text: 'Energy consumption for appliances(kWh)'
            }

            },

	
            tooltip: {
		
                formatter: function() {
                    var s;
                    if (this.point.name) { // the pie chart
                        s = ''+
                            this.point.name +': '+ this.point.percentage.toFixed(2) +' %';
                    } else {
                        s = ''+
                            this.x  +': '+ this.y;
                    }
                    return s;
                }
            },
            labels: {
                items: [{
                    html: 'Total appliance share',
                    style: {
                        left: '100px',
                        top: '0px',
                        color: 'black'
                    }
                }]
            },
            series: values
        });
      });   
    }else if($(target).attr('id')=='kresit'){
	$('#datecontainer').show();
	$('#master').hide();
	
	clearInterval(interval);
      var dataFile = "pymongo/Kresit-data-json.php?date="+$('#datepicker').val(); 
      $.getJSON(dataFile, function(jsonData) {
         var days = [];
         var values = [];
         $.each(jsonData.components,function(entryIndex, entry) {
            values.push(this.value);
         });
	 $.each(jsonData.days,function(entryIndex, entry) {
            days[entryIndex]=this;
         });
      $('#container1').highcharts({
            chart: {
                zoomType: 'xy'
            },
            title: {
                text: 'Energy Consumption in KReSIT vs Temperature '
            },
            subtitle: {
                text: 'Source: SEIL IIT,Bombay'
            },
            xAxis: [{
                categories: days
            }],
            yAxis: [{ // Primary yAxis
                labels: {
                    format: '{value}'+jsonData.unit2,
                    style: {
                        color: '#89A54E'
                    }
                },
                title: {
                    text: 'Temperature',
                    style: {
                        color: '#89A54E'
                    }
                }
            }, { // Secondary yAxis
                title: {
                    text: 'Energy',
                    style: {
                        color: '#4572A7'
                    }
                },
                labels: {
                    format: '{value}'+jsonData.unit1,
                    style: {
                        color: '#4572A7'
                    }
                },
                opposite: true
            }],
            tooltip: {
                shared: true
            },
            legend: {
                layout: 'vertical',
                align: 'left',
                x: 120,
                verticalAlign: 'top',
                y: 100,
                floating: true,
                backgroundColor: '#FFFFFF'
            },
            series: [{
                name: 'Energy',
                color: '#4572A7',
                type: 'column',
                yAxis: 1,
                data: values[0],
                tooltip: {
                    valueSuffix: jsonData.unit1
                }
    
            }, {
                name: 'Temperature',
                color: '#89A54E',
                type: 'spline',
                data: values[1],
                tooltip: {
                    valueSuffix: jsonData.unit2
                }
            }]
        });
      });
    }else{
	$('#datecontainer').hide();
	$('#master').show();
	clearInterval(interval);     

	/*for(x=0;x<$('#duration').val()*7; x++)
	{
		data.push(Math.random());
	}*/
	
	update_data();
		var masterChart,
        detailChart;
    
    $(document).ready(function() {
    
    
        // create the master chart
        function createMaster() {
            masterChart = $('#master-container1').highcharts({
                chart: {
                    reflow: false,
                    borderWidth: 0,
                    backgroundColor: null,
                    marginLeft: 50,
                    marginRight: 20,
                    zoomType: 'x',
                    events: {
    
                        // listen to the selection event on the master chart to update the
                        // extremes of the detail chart
                        selection: function(event) {
                            var extremesObject = event.xAxis[0],
                                min = extremesObject.min,
                                max = extremesObject.max,
                                detailData = [],
                                xAxis = this.xAxis[0];
    
                            // reverse engineer the last part of the data
                            jQuery.each(this.series[0].data, function(i, point) {
                                if (point.x > min && point.x < max) {
                                    detailData.push({
                                        x: point.x,
                                        y: point.y
                                    });
                                }
                            });
    
                            // move the plot bands to reflect the new detail span
                            xAxis.removePlotBand('mask-before');
                            xAxis.addPlotBand({
                                id: 'mask-before',
                                from: (new Date()).setDate((new Date()).getDate() - ($('#duration').val() * 30)),
                                to: min,
                                color: 'rgba(0, 0, 0, 0.2)'
                            });
    
                            xAxis.removePlotBand('mask-after');
                            xAxis.addPlotBand({
                                id: 'mask-after',
                                from: max,
                                to: new Date(),
                                color: 'rgba(0, 0, 0, 0.2)'
                            });
    
    
                            detailChart.series[0].setData(detailData);
    
                            return false;
                        }
                    }
                },
                title: {
                    text: null
                },
                xAxis: {
                    type: 'datetime',
                    showLastTickLabel: true,
                    maxZoom: 14 * 24 * 3600000, // fourteen days
                    plotBands: [{
                        id: 'mask-before',
                        from: (new Date()).setDate((new Date()).getDate() - ($('#duration').val() * 30)),
                        to: (new Date()).setDate((new Date()).getDate() - ($('#duration').val() * 20)),
                        color: 'rgba(0, 0, 0, 0.2)'
                    }],
                    title: {
                        text: null
                    }
                },
                yAxis: {
                    gridLineWidth: 0,
                    labels: {
                        enabled: false
                    },
                    title: {
                        text: null
                    },
                    min: 0.6,
                    showFirstLabel: false
                },
                tooltip: {
                    formatter: function() {
                        return false;
                    }
                },
                legend: {
                    enabled: false
                },
                credits: {
                    enabled: false
                },
                plotOptions: {
                    series: {
                        fillColor: {
                            linearGradient: [0, 0, 0, 70],
                            stops: [
                                [0, Highcharts.getOptions().colors[0]],
                                [1, 'rgba(255,255,255,0)']
                            ]
                        },
                        lineWidth: 1,
                        marker: {
                            enabled: false
                        },
                        shadow: false,
                        states: {
                            hover: {
                                lineWidth: 1
                            }
                        },
                        enableMouseTracking: false
                    }
                },
    
                series: [{
                    type: 'area',
                    name: "Time vs "+$('#parameter').find(':selected').text(),
                    pointInterval: 3600 * 1000,
                    pointStart: (new Date()).setDate((new Date()).getDate() - ($('#duration').val()*30)),
                    data: data
                }],
    
                exporting: {
                    enabled: false
                }
    
            }, function(masterChart) {
                createDetail(masterChart)
            })
            .highcharts(); // return chart instance
        }
    
        // create the detail chart
        function createDetail(masterChart) {
    
            // prepare the detail chart
            var detailData = [],
                detailStart = (new Date()).setDate((new Date()).getDate() - 30);
    
            jQuery.each(masterChart.series[0].data, function(i, point) {
                if (point.x >= detailStart) {
                    detailData.push(point.y);
                }
            });
    
            // create a detail chart referenced by a global variable
            detailChart = $('#detail-container1').highcharts({
                chart: {
                    marginBottom: 120,
                    reflow: false,
                    marginLeft: 50,
                    marginRight: 20,
                    style: {
                        position: 'absolute'
                    }
                },
                credits: {
                    enabled: false
                },
                title: {
                    text: 'Historic data of '+$('#parameter').find(':selected').text()+' over time'
                },
                subtitle: {
                    text: 'Select an area by dragging across the lower chart'
                },
                xAxis: {
                    type: 'datetime'
                },
                yAxis: {
                    title: {
                        text: null
                    },
                    maxZoom: 0.1
                },
                tooltip: {
                    formatter: function() {
                        var point = this.points[0];
                        return '<b>'+ point.series.name +'</b><br/>'+
                            Highcharts.dateFormat('%A %B %e %Y', this.x) + ':<br/>'+
                            $('#parameter').find(':selected').text()+' = '+ Highcharts.numberFormat(point.y, 2);
                    },
                    shared: true
                },
                legend: {
                    enabled: false
                },
                plotOptions: {
                    series: {
                        marker: {
                            enabled: false,
                            states: {
                                hover: {
                                    enabled: true,
                                    radius: 3
                                }
                            }
                        }
                    }
                },
                series: [{
                    name: 'Time vs '+$('#parameter').find(':selected').text(),
                    pointStart: detailStart,
                    pointInterval: 3600 * 1000,
                    data: detailData
                }],
    
                exporting: {
                    enabled: false
                }
    
            }).highcharts(); // return chart
        }
    
        // make the container smaller and add a second container for the master chart
	$('#chartsdiv').html('');
	var $chartdiv = $('#chartsdiv');
	var $container = $('<div id="container1">')
		.css('position', 'relative')          
		.appendTo($chartdiv);
            
    
        var $detailContainer = $('<div id="detail-container1">')
            .appendTo($container);
    
        var $masterContainer = $('<div id="master-container1">')
            .css({ position: 'absolute', top: 300, height: 100 })
            .appendTo($container);
    
        // create master and in its callback, create the detail chart
        createMaster();
    });
  
	}
 }


function update_data(){
	$.ajax({
		type:"GET",
		url:"pymongo/getHistoricalData.php?duration="+$('#duration').val()+"&parameter="+$('#parameter').val(),
		async:false,
		success:function(response){
			data = response.split(",");
			for(x in data)
				data[x] = parseFloat(data[x])
			
			
		}
	});
 		
}

   function update_contest_section(target){

    $(target).parent().parent().children().removeClass('active')
    $(target).parent().addClass('active')
    var week = $("#dropDown").val();
    var dataFile = "data/jw"+week+".json";

    if($(target).attr('id')=='stats'){

      $.getJSON(dataFile, function(jsonData) {
         var conditions = [];
         var map = {};
         var values = [];
         $.each(jsonData.categories,function(entryIndex, entry) {
            conditions[entryIndex]= this;
         });
         $.each(jsonData.data,function(entryIndex, entry) {
            map[this.lab]=this.values;
         });
         index = 0;
         $.each( map, function( key, value ) {
            values[index] = {name:key,data:value};
            index = index + 1;
         });
         $('#container').highcharts({
            chart: {
             type: 'column'
          },
          title: {
             text: 'Contest for Week '+ jsonData.week + ' starting from '+jsonData.date 
          },
          subtitle: {
             text: 'Source: SEIL IIT,Bombay'
          },
          xAxis: {

             categories: conditions
          },
          yAxis: {
             min: 0,
             title: {
              text: 'Per Capita Power Consumption ('+jsonData.unit+')'
           }
        },
        tooltip: {
          headerFormat: '<span style="font-size:10px">{point.key}</span><table>',
          pointFormat: '<tr><td style="color:{series.color};padding:0">{series.name}: </td>' +
          '<td style="padding:0"><b>{point.y:.1f} '+jsonData.unit+'</b></td></tr>',
          footerFormat: '</table>',
          shared: true,
          useHTML: true
       },
       plotOptions: {
          column: {
           pointPadding: 0.2,
           borderWidth: 0
        }
     },
     series: values
  });
});   
}else if($(target).attr('id')=='score'){   
   $.getJSON(dataFile, function(jsonData) {
      var labs = [];
      var scores = {};
      var values = [];
      $.each(jsonData.data,function(entryIndex, entry) {
         labs[entryIndex] = this.lab;
         scores[this.lab] = this.score;
      });
      index = 0;
      $.each( scores, function( key, value ) {
         values[index] = {name:key,data:[value]};
         index = index + 1;
      });
      $('#container').highcharts({
         chart: {
          type: 'column'
       },
       title: {
          text: 'Contest for Week '+ jsonData.week + ' starting from '+jsonData.date 
       },
       subtitle: {
          text: 'Source: SEIL IIT,Bombay'
       },
       xAxis: {

          categories: ["Labs"]
       },
       yAxis: {
          min: 0,
          title: {
           text: 'Measure of Energy Consumption'
        }
     },
     tooltip: {
       headerFormat: '<span style="font-size:10px">{point.key}</span><table>',
       pointFormat: '<tr><td style="color:{series.color};padding:0">{series.name}: </td>' +
       '<td style="padding:0"><b>{point.y:.1f} </b></td></tr>',
       footerFormat: '</table>',
       shared: true,
       useHTML: true
    },
    plotOptions: {
       column: {
        pointPadding: 0.2,
        borderWidth: 0
     }
  },
  series: values
});
   });   
}else if($(target).attr('id')=='winner'){
   $.getJSON("data/winner.json", function(jsonData) {
      var victories = {}
      var values = []
     
      $.each(jsonData.winners,function(entryIndex, entry) {
         victories[this.lab] = this.winnings;
      });
      console.log(victories);
      index = 0;
      $.each(victories, function( key, value ) {
         values[index] = [key,value];
         index = index + 1;
      });
      console.log(values);
      $('#container').highcharts({
         chart: {
            plotBackgroundColor: null,
            plotBorderWidth: null,
            plotShadow: false
         },
         title: {
            text: 'No. of victories for each lab'
         },
         tooltip: {
          pointFormat: '{series.name}: <b>{point.percentage:.1f}%</b>'
       },
       plotOptions: {
         pie: {
          allowPointSelect: true,
          cursor: 'pointer',
          dataLabels: {
           enabled: true,
           color: '#000000',
           connectorColor: '#000000',
           format: '<b>{point.name}</b>: {y}'
        }
     }
  },
  series: [{
   type: 'pie',
   name: 'victories',
   data: values
}]
});
   });
}else if($(target).attr('id')=='comparision'){
   $.getJSON(dataFile, function(jsonData) {
      var conditions = [];
      var map = {};
      var values = [];
      $.each(jsonData.data,function(entryIndex, entry) {
         map[this.lab]=this.cvalues;
      });
      index = 0;
      $.each( map, function( key, value ) {
         values[index] = {name:key,data:value};
         index = index + 1;
      });

      $(function () {
        $('#container').highcharts({
         chart: {
          type: 'column'
       },
       title: {
          text: 'Comparision of each lab with KReSIT Per Capita Energy Consumption'
       },
       xAxis: {
          categories: ['Per Capita Energy Consumption']
       },
	yAxis: {
         title: {
           text: 'Per capita energy consumption deviation(%)'
        }
       },
       credits: {
          enabled: false
       },
       series: values
    });
     });

   });
}else{
		var div = $("<div></div>");
	div.addClass("component");
	var data = '<p>Below is the list of defaulters</p>';
	div.html(data);
	var table = $("<table></table>");
	var tr = $("<thead></thead>");
	var theader = "<tr><th>Lab Name</th><th>Deviation(%)</th><th>PerCapita Energy(kWh)</th><th>Total Energy(Kwh)</th><th>Peak Power(kW)</th></tr>";
	tr.append(theader);
	table.append(tr);
	var tbody = $("<tbody></tbody>");
	var tr = $("<tr></tr>");
	var td = "<td>ASL</td><td>19.7</td><td>41.631</td><td>287.71</td><td>15.746</td>";
	tr.append(td);
	tbody.append(tr);
	var tr = $("<tr></tr>");
	var td = "<td>CSL</td><td>14.5</td><td>35.63</td><td>227.73</td><td>10.74</td>";
	tr.append(td);
	tbody.append(tr);
	var tr = $("<tr></tr>");
	var td = "<td>MoocLab</td><td>11.2</td><td>27.631</td><td>207.74</td><td>13.74</td>";
	tr.append(td);
	tbody.append(tr);
	table.append(tbody);
	div.append(table);
	$('#container').html(div);
   

}
return true
};

 $(document).ready(function() {
        Highcharts.setOptions({
            global: {
                useUTC: false
            }
   });
});


$('#dropDown').on('change',function(){
  console.log('#vnav .active a');
  update_contest_section($('#vnav .active a'));
});
$('#parameter').on('change',function(){
  console.log($('#vnav .active a'));

	   
	update_dashboard_section($('#masterdetail'));
  	
});
$('#duration').on('change',function(){
  console.log($('#vnav .active a'));
	   
	update_dashboard_section($('#masterdetail'));
  	
});
</script>
</body>

</html>
